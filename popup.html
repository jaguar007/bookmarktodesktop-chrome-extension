<html>
<head><title>Bookmark to desktop Chrome extension</title></head>
<style>
body {
  min-width:300px;
  overflow-x:hidden;
  font-family: verdana;
}

img {
  float:left;
}

h1 {
  font-size: 15px;
  font-decoration: bold;
  margin-bottom: 6px;
}

.small {
  font-size: 12px;
}

</style>

<script>
// analytics code
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-19731716-1']);
_gaq.push(['_trackPageview']);

(function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = 'https://ssl.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

function trackButton(name) {
  _gaq.push(['_trackEvent', name, 'clicked']);
};


function open_settings() {
  properties = new Object();
  properties.url = "options.html"
  chrome.tabs.create(properties, null);
}

function fetch_bookmarks() {
  trackButton('checknow');
  chrome.extension.getBackgroundPage().fetch_bookmarks(true);
}

function check_login() {
  var username = localStorage["username"]
  var password = localStorage["password"]
  var push = localStorage["userwantspush"]

  if (!password || !username || password == '' || username == '') {
    document.getElementById('popup_message').innerHTML = '<p>Plugin not configured yet.</p><p><button onclick=\"open_settings()\">Configure now</button></p>';
  } else {
    document.getElementById('popup_message').innerHTML = '<p>Bookmark check scheduled every 30minutes.</p><p><button onclick=\"fetch_bookmarks()\" >Check now</button></p>';
  }

  if (push) {
    if (isconnected()) {
      document.getElementById("push_message").innerHTML = '<p>Receiving PUSH notifications is enabled.</p>';
    } else {
      document.getElementById("push_message").innerHTML = '<p>Failed to contact PUSH server</p><p><button onclick=\"loginxmpp\">Retry</button></p>';
    }
  } else {
    document.getElementById("push_message").innerHTML = '<p>Receiving PUSH notifications is disabled. Go to options to enable.</p>';
  }
}

function loginxmpp() {
  console.log('loginxmpp');
  chrome.extension.getBackgroundPage().doLogin();
}

function isconnected() {
  return chrome.extension.getBackgroundPage().connected;
}

</script>
<body onload="check_login()">
<img src="icon.png" width="60px" height="60px"/>
<h1>Bookmark to desktop</h1>
<span class="small" id="popup_message" ></span>
<span class="small" id="push_message" ></span>
</body>
</html>
